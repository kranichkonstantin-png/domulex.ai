#!/usr/bin/env python3
"""Praxiswissen Seeding - Anleitungen, FAQs, Muster"""

import google.generativeai as genai
from qdrant_client import QdrantClient
from qdrant_client.models import PointStruct
import os
import uuid

genai.configure(api_key=os.environ['GEMINI_API_KEY'])
client = QdrantClient(host=os.environ['QDRANT_HOST'], port=6333, api_key=os.environ['QDRANT_API_KEY'], https=True)

def embed(text):
    return genai.embed_content(model='models/text-embedding-004', content=text[:8000])['embedding']

print('üöÄ PRAXISWISSEN SEEDING')

praxis = [
    # Mietrecht Praxis
    {'title': 'Wie schreibe ich eine Mietminderungsanzeige?', 'content': 'Eine Mietminderungsanzeige muss folgende Elemente enthalten: 1. Genaue Beschreibung des Mangels mit Datum der Feststellung. 2. Aufforderung zur Beseitigung mit Fristsetzung (in der Regel 14 Tage). 3. Ank√ºndigung der Mietminderung ab sofort. 4. H√∂he der Minderung prozentual angeben. Die Anzeige sollte per Einschreiben mit R√ºckschein erfolgen. Fotos oder Protokolle als Beweis beif√ºgen. Bei Schimmel ist eine Minderung von 20-50% √ºblich, bei Heizungsausfall im Winter bis zu 100%.', 'source': 'Praxisratgeber', 'category': 'Mietrecht', 'doc_type': 'Anleitung'},
    {'title': 'Nebenkostenabrechnung pr√ºfen - Schritt f√ºr Schritt', 'content': 'Pr√ºfung der Nebenkostenabrechnung: 1. Abrechnungszeitraum korrekt (max. 12 Monate)? 2. Frist eingehalten (12 Monate nach Abrechnungszeitraum)? 3. Verteilerschl√ºssel vereinbart und angewendet? 4. Nur umlagef√§hige Kosten nach BetrKV? 5. Plausibilit√§t der Gesamtkosten pr√ºfen. 6. Bei Zweifeln Belege anfordern (Frist: 12 Monate nach Zugang). H√§ufige Fehler: Instandhaltungskosten, Verwaltungskosten, Leerstandskosten zu Lasten der Mieter.', 'source': 'Praxisratgeber', 'category': 'Mietrecht', 'doc_type': 'Anleitung'},
    {'title': 'Widerspruch gegen Eigenbedarfsk√ºndigung', 'content': 'Widerspruch nach ¬ß 574 BGB: 1. Frist beachten: Sp√§testens 2 Monate vor Mietende. 2. Schriftform erforderlich. 3. H√§rtegr√ºnde darlegen: Alter, Krankheit, Schwangerschaft, lange Wohndauer, fehlender Ersatzwohnraum. 4. Nachweis der H√§rtegr√ºnde beif√ºgen (Atteste, Bescheinigungen). 5. Interessenabw√§gung beantragen. Der Vermieter muss auf das Widerspruchsrecht im K√ºndigungsschreiben hinweisen.', 'source': 'Praxisratgeber', 'category': 'Mietrecht', 'doc_type': 'Anleitung'},
    {'title': 'Kaution richtig zur√ºckfordern', 'content': 'Kautionsr√ºckforderung nach Auszug: 1. √úbergabeprotokoll anfertigen mit Zustand der Wohnung. 2. Abrechnungsfrist des Vermieters: 3-6 Monate. 3. Schriftliche Aufforderung mit Fristsetzung. 4. Zinsanspruch geltend machen (gesetzliche Anlage). 5. Berechtigung von Abz√ºgen pr√ºfen: Nur f√ºr tats√§chliche Sch√§den, nicht f√ºr normale Abnutzung. 6. Bei Verweigerung: Mahnverfahren oder Klage beim Amtsgericht.', 'source': 'Praxisratgeber', 'category': 'Mietrecht', 'doc_type': 'Anleitung'},
    {'title': 'Mieterh√∂hung - Reaktionsm√∂glichkeiten', 'content': 'Bei Mieterh√∂hung nach ¬ß 558 BGB: 1. Formale Pr√ºfung (schriftlich, Begr√ºndung, Mietspiegel?). 2. Vergleichsmiete pr√ºfen (Mietspiegel, Vergleichswohnungen, Gutachten). 3. Kappungsgrenze beachten (20% in 3 Jahren, 15% in angespannten M√§rkten). 4. Zustimmungsfrist: 2 Monate. 5. Bei Ablehnung: Vermieter muss klagen. 6. Teilzustimmung m√∂glich bei √ºberh√∂hter Forderung. 7. Sonderk√ºndigungsrecht bei Zustimmung.', 'source': 'Praxisratgeber', 'category': 'Mietrecht', 'doc_type': 'Anleitung'},
    
    # WEG Praxis
    {'title': 'Eigent√ºmerversammlung vorbereiten und durchf√ºhren', 'content': 'Eigent√ºmerversammlung: 1. Einladung durch Verwalter (3 Wochen vorher, Textform). 2. Tagesordnung mit allen Beschlusspunkten. 3. Vollmachten f√ºr abwesende Eigent√ºmer. 4. Beschlussf√§higkeit pr√ºfen (mehr als 50% MEA anwesend). 5. Protokoll f√ºhren mit allen Beschl√ºssen. 6. Abstimmung nach Kopfprinzip oder MEA je nach Vereinbarung. 7. Unterschrift des Versammlungsleiters und eines Eigent√ºmers. 8. Versand des Protokolls an alle Eigent√ºmer.', 'source': 'Praxisratgeber', 'category': 'WEG', 'doc_type': 'Anleitung'},
    {'title': 'Beschlussanfechtung WEG richtig machen', 'content': 'Anfechtung eines WEG-Beschlusses: 1. Frist: 1 Monat ab Beschlussfassung (nicht ab Protokollerhalt). 2. Zust√§ndig: Amtsgericht. 3. Anfechtungsgr√ºnde: Formfehler, Versto√ü gegen Vereinbarung oder Gesetz, Ungleichbehandlung. 4. Parteien: Kl√§ger gegen WEG-Gemeinschaft (nicht einzelne Eigent√ºmer). 5. Kosten: Streitwert richtet sich nach Interesse. 6. W√§hrend des Verfahrens gilt der Beschluss weiterhin.', 'source': 'Praxisratgeber', 'category': 'WEG', 'doc_type': 'Anleitung'},
    {'title': 'Sonderumlage WEG - Rechte und Pflichten', 'content': 'Sonderumlage bei WEG: 1. Beschluss erforderlich mit einfacher Mehrheit. 2. Verwendungszweck muss angegeben sein. 3. H√∂he muss verh√§ltnism√§√üig sein. 4. F√§lligkeit wird im Beschluss geregelt. 5. Ratenzahlung kann beschlossen werden. 6. Bei Eigentumswechsel: Beschlossene Sonderumlagen gehen auf Erwerber √ºber. 7. Anfechtbar bei offensichtlicher Willk√ºr oder falscher Berechnung.', 'source': 'Praxisratgeber', 'category': 'WEG', 'doc_type': 'Anleitung'},
    
    # Immobilienkauf Praxis
    {'title': 'Immobilienkauf Schritt f√ºr Schritt', 'content': 'Ablauf Immobilienkauf: 1. Besichtigung und Pr√ºfung (Zustand, Lage, Grundbuch). 2. Finanzierungszusage einholen. 3. Reservierungsvereinbarung (optional). 4. Notartermin vereinbaren. 5. Kaufvertrag beim Notar beurkunden. 6. Auflassungsvormerkung im Grundbuch. 7. Kaufpreis nach F√§lligkeitsmitteilung zahlen. 8. Grunderwerbsteuer zahlen (Unbedenklichkeitsbescheinigung). 9. Eigentumsumschreibung im Grundbuch. 10. Schl√ºssel√ºbergabe und Besitz√ºbergang.', 'source': 'Praxisratgeber', 'category': 'Grundst√ºcksrecht', 'doc_type': 'Anleitung'},
    {'title': 'Was ist im Grundbuch zu pr√ºfen vor Kauf?', 'content': 'Grundbuchpr√ºfung vor Kauf: 1. Abteilung I: Eigent√ºmer pr√ºfen (Verkaufsberechtigung). 2. Abteilung II: Belastungen wie Wegerechte, Wohnrechte, Nie√übrauch, Vormerkungen. 3. Abteilung III: Grundpfandrechte (Hypotheken, Grundschulden) - m√ºssen gel√∂scht werden. 4. Altlasten im Baulastenverzeichnis pr√ºfen. 5. Flurkarte und Bebauungsplan beim Bauamt einsehen. 6. Grundst√ºcksgrenzen mit Katasteramt abgleichen.', 'source': 'Praxisratgeber', 'category': 'Grundst√ºcksrecht', 'doc_type': 'Anleitung'},
    {'title': 'Grunderwerbsteuer Berechnung und F√§lligkeit', 'content': 'Grunderwerbsteuer: 1. Bemessungsgrundlage: Kaufpreis ohne Inventar. 2. Steuers√§tze nach Bundesland: 3,5% (Bayern, Sachsen) bis 6,5% (Brandenburg, NRW, Schleswig-Holstein). 3. F√§lligkeit: 1 Monat nach Steuerbescheid. 4. Keine GrESt bei Erbschaft, Schenkung oder Erwerb zwischen Ehegatten. 5. Unbedenklichkeitsbescheinigung erforderlich f√ºr Grundbucheintragung. 6. K√§ufer und Verk√§ufer haften gesamtschuldnerisch.', 'source': 'Praxisratgeber', 'category': 'Steuerrecht', 'doc_type': 'Anleitung'},
    
    # Baurecht Praxis
    {'title': 'Bauabnahme richtig durchf√ºhren', 'content': 'Bauabnahme Checkliste: 1. Begehung aller R√§ume mit Bauunternehmer. 2. Protokoll mit allen M√§ngeln erstellen. 3. Fotos von M√§ngeln anfertigen. 4. Frist f√ºr M√§ngelbeseitigung setzen. 5. Vorbehalt bekannter M√§ngel erkl√§ren. 6. Bei wesentlichen M√§ngeln: Abnahme verweigern. 7. Nach Abnahme beginnt Gew√§hrleistungsfrist (5 Jahre). 8. Schlusszahlung erst nach Abnahme f√§llig. 9. Bei VOB-Vertrag: Fiktive Abnahme nach 12 Werktagen beachten.', 'source': 'Praxisratgeber', 'category': 'Baurecht', 'doc_type': 'Anleitung'},
    {'title': 'Baugenehmigung beantragen - Anleitung', 'content': 'Baugenehmigung beantragen: 1. Bauvoranfrage f√ºr grunds√§tzliche Genehmigungsf√§higkeit (optional). 2. Bauantragsformulare beim Bauamt besorgen. 3. Erforderliche Unterlagen: Lageplan, Bauzeichnungen, Baubeschreibung, Berechnungen, Nachweis Standsicherheit. 4. Einreichung durch bauvorlageberechtigten Architekten/Ingenieur. 5. Nachbarbeteiligung (Unterschriften oder beh√∂rdliche Benachrichtigung). 6. Bearbeitungszeit: 2-4 Monate. 7. Baugenehmigung 3 Jahre g√ºltig.', 'source': 'Praxisratgeber', 'category': 'Baurecht', 'doc_type': 'Anleitung'},
    
    # Steuerrecht Praxis
    {'title': 'Vermietungsabsicht steuerlich nachweisen', 'content': 'Nachweis der Eink√ºnfteerzielungsabsicht: 1. Inserieren auf Immobilienportalen dokumentieren. 2. Besichtigungstermine protokollieren. 3. Makler beauftragen und Nachweis aufbewahren. 4. Markt√ºbliche Miete verlangen. 5. Renovierungsma√ünahmen f√ºr Vermietung durchf√ºhren. 6. Finanzierungskosten auch bei Leerstand absetzbar. 7. Bei dauerhaftem Leerstand: Prognose √ºber 30 Jahre erstellen. 8. Orts√ºbliche Vermarktungsbem√ºhungen nachweisen.', 'source': 'Praxisratgeber', 'category': 'Steuerrecht', 'doc_type': 'Anleitung'},
    {'title': 'Abschreibung Immobilie richtig berechnen', 'content': 'AfA bei vermieteten Immobilien: 1. Geb√§udeanteil ermitteln (Kaufpreis minus Bodenwert). 2. AfA-Satz: 2% f√ºr Geb√§ude ab 1925, 2,5% vor 1925, 3% f√ºr Neubauten ab 2023. 3. Anschaffungsnebenkosten hinzurechnen (Notar, Grunderwerbsteuer, Makler). 4. Bei Denkmal: 9% in ersten 8 Jahren, 7% in folgenden 4 Jahren m√∂glich. 5. Sonder-AfA ¬ß 7b f√ºr Mietwohnungsneubau: 5% zus√§tzlich in 4 Jahren. 6. AfA nicht bei Eigentumswohnung im Eigenheim.', 'source': 'Praxisratgeber', 'category': 'Steuerrecht', 'doc_type': 'Anleitung'},
    
    # Nachbarrecht Praxis
    {'title': 'Nachbarstreit wegen L√§rm - Vorgehensweise', 'content': 'Bei L√§rmbel√§stigung durch Nachbarn: 1. L√§rmprotokoll f√ºhren (Datum, Uhrzeit, Art, Dauer). 2. Direkte Ansprache des Nachbarn versuchen. 3. Vermieter informieren (bei Mietwohnung). 4. Hausverwaltung einschalten (bei WEG). 5. Schriftliche Abmahnung an St√∂rer. 6. Ordnungsamt bei Verst√∂√üen gegen Ruhezeiten. 7. Zivilklage auf Unterlassung bei Dauerst√∂rung. 8. Mietminderung bei erheblicher Beeintr√§chtigung (10-50%). 9. Fristlose K√ºndigung bei nachhaltiger Pflichtverletzung.', 'source': 'Praxisratgeber', 'category': 'Nachbarrecht', 'doc_type': 'Anleitung'},
    {'title': 'Grenzbebauung - Was ist erlaubt?', 'content': 'Grenzbebauung und Abstandsfl√§chen: 1. Mindestabstand je nach Landesbauordnung (meist 3m). 2. Abstandsfl√§che = Wandh√∂he x Faktor (0,4-1,0 je nach Bundesland). 3. Privilegierte Bauteile: Garagen bis 9m L√§nge und 3m H√∂he grenznah erlaubt. 4. Carports und Gartenh√§user oft genehmigungsfrei. 5. Einverst√§ndnis des Nachbarn erm√∂glicht Unterschreitung. 6. Baulast ins Baulastenverzeichnis eintragen. 7. Bestandsschutz f√ºr alte Geb√§ude. 8. Nachtr√§gliche Genehmigung bei √úberbau schwierig.', 'source': 'Praxisratgeber', 'category': 'Baurecht', 'doc_type': 'Anleitung'},
    
    # Maklerrecht Praxis
    {'title': 'Maklervertrag pr√ºfen - Worauf achten?', 'content': 'Maklervertrag Checkliste: 1. Provisionsh√∂he (√ºblich: 3-6% plus MwSt beim Kauf, 2 Monatsmieten bei Vermietung). 2. Alleinauftrag oder einfacher Auftrag? 3. Laufzeit und K√ºndigungsm√∂glichkeit. 4. Nachweis- oder Vermittlungsprovision? 5. Erfolgsabh√§ngigkeit (nur bei Abschluss). 6. Aufwendungsersatz bei Nichterfolg? 7. Bestellerprinzip bei Vermietung beachten. 8. Widerrufsrecht bei Fernabsatzvertr√§gen (14 Tage).', 'source': 'Praxisratgeber', 'category': 'Maklerrecht', 'doc_type': 'Anleitung'},
    
    # FAQ-Sammlung
    {'title': 'FAQ: Wie viel Mieterh√∂hung ist zul√§ssig?', 'content': 'Die zul√§ssige Mieterh√∂hung richtet sich nach verschiedenen Faktoren: 1. Anpassung an orts√ºbliche Vergleichsmiete nach ¬ß 558 BGB mit Kappungsgrenze von 20% in 3 Jahren (15% in angespannten M√§rkten). 2. Staffelmiete oder Indexmiete nach Vereinbarung. 3. Modernisierungsmieterh√∂hung um 8% der Kosten. 4. Bei Neuvermietung: Mietpreisbremse in Gebieten mit angespanntem Wohnungsmarkt (max. 10% √ºber Vergleichsmiete). 5. Die Miete muss mindestens 15 Monate unver√§ndert sein.', 'source': 'FAQ', 'category': 'Mietrecht', 'doc_type': 'FAQ'},
    {'title': 'FAQ: Wann darf der Vermieter die Wohnung betreten?', 'content': 'Der Vermieter hat kein generelles Zutrittsrecht. Betreten ist nur erlaubt bei: 1. Notf√§llen (Wasserschaden, Feuer, Gas). 2. Vereinbarter Besichtigung mit angemessener Vorank√ºndigung (24-48 Stunden). 3. Durchf√ºhrung von Reparaturen nach Ank√ºndigung. 4. Verkaufs- oder Neuvermietungsbesichtigungen in angemessenem Rahmen. 5. Ablesung von Messger√§ten. Der Mieter kann den Zutritt verweigern, wenn kein berechtigter Grund vorliegt. Eigenm√§chtiges Betreten ist Hausfriedensbruch.', 'source': 'FAQ', 'category': 'Mietrecht', 'doc_type': 'FAQ'},
    {'title': 'FAQ: Was sind umlagef√§hige Nebenkosten?', 'content': 'Umlagef√§hige Nebenkosten nach ¬ß 2 BetrKV: 1. Grundsteuer. 2. Wasserversorgung und Entw√§sserung. 3. Heizkosten und Warmwasser. 4. Aufzugskosten. 5. Stra√üenreinigung und M√ºllabfuhr. 6. Geb√§udereinigung und Ungezieferbek√§mpfung. 7. Gartenpflege. 8. Beleuchtung. 9. Schornsteinreinigung. 10. Sach- und Haftpflichtversicherung. 11. Hauswart. 12. Gemeinschaftsantenne/Kabel. Nicht umlagef√§hig: Verwaltungskosten, Instandhaltungsr√ºcklagen, Reparaturen.', 'source': 'FAQ', 'category': 'Mietrecht', 'doc_type': 'FAQ'},
    {'title': 'FAQ: Was muss bei Auszug renoviert werden?', 'content': 'Renovierungspflicht bei Auszug: 1. Bei unrenovierter √úbernahme: Keine Renovierungspflicht (BGH-Rechtsprechung). 2. Bei renovierter √úbernahme: Nur bei wirksamer Renovierungsklausel. 3. Starre Fristen (alle X Jahre) sind unwirksam. 4. Normale Abnutzung muss nicht beseitigt werden. 5. Vereinbarter Endrenovierung muss Abnutzung ber√ºcksichtigen. 6. Keine Fachhandwerkerklausel zul√§ssig. 7. Besenreine √úbergabe ist Standard. 8. D√ºbell√∂cher verschlie√üen bei mehr als orts√ºblicher Anzahl.', 'source': 'FAQ', 'category': 'Mietrecht', 'doc_type': 'FAQ'},
    {'title': 'FAQ: Wer zahlt die Maklerprovision?', 'content': 'Maklerprovision: 1. Bei Vermietung: Bestellerprinzip - wer beauftragt, zahlt (meist Vermieter). Max. 2 Monatsmieten netto + MwSt. 2. Bei Wohnungskauf: Halbteilung seit Dezember 2020 - K√§ufer zahlt maximal so viel wie Verk√§ufer. √úblich 3-6% des Kaufpreises. 3. Bei Gewerbeimmobilien: Frei vereinbar. 4. Bei Ferienwohnungen: Bestellerprinzip gilt nicht. 5. Provision nur bei Erfolg geschuldet (Vertragsabschluss). 6. Voraussetzung: wirksamer Maklervertrag.', 'source': 'FAQ', 'category': 'Maklerrecht', 'doc_type': 'FAQ'},
    {'title': 'FAQ: Kann ich als Eigent√ºmer jederzeit k√ºndigen?', 'content': 'K√ºndigungsrecht des Eigent√ºmer-Vermieters: 1. Ordentliche K√ºndigung nur bei berechtigtem Interesse (¬ß 573 BGB). 2. Berechtigte Gr√ºnde: Eigenbedarf, erhebliche Pflichtverletzung, wirtschaftliche Verwertung. 3. K√ºndigungsfristen: 3/6/9 Monate je nach Wohndauer. 4. Fristlose K√ºndigung bei Zahlungsverzug (2 Monatsmieten) oder nachhaltiger Pflichtverletzung. 5. Sperrfrist nach Umwandlung in Eigentumswohnung: 3-10 Jahre je nach Bundesland. 6. K√ºndigung muss begr√ºndet werden.', 'source': 'FAQ', 'category': 'Mietrecht', 'doc_type': 'FAQ'},
]

print(f'üì§ Uploading {len(praxis)} Dokumente...')
points = []
for i, doc in enumerate(praxis):
    vector = embed(doc['content'])
    points.append(PointStruct(id=str(uuid.uuid4()), vector=vector, payload=doc))
    if (i+1) % 10 == 0:
        print(f'  üìù {i+1}/{len(praxis)} embedded...')

for i in range(0, len(points), 25):
    batch = points[i:i+25]
    client.upsert(collection_name='legal_documents', points=batch)
    print(f'  ‚úÖ Batch {i//25+1}: {len(batch)} docs')

info = client.get_collection('legal_documents')
print(f'üìä Gesamt: {info.points_count} Dokumente')
